#user  nobody;
worker_processes <%= @passenger[:worker_processes] %>;
error_log  <%= @log_path %>/error.log;
pid <%= @pidfile %>;

events {
  worker_connections  <%= @passenger[:worker_connections] %>;
}

include conf.d/*.conf;

http {
  passenger_root <%= @passenger_root %>;
  passenger_ruby <%= @ruby_path %>;
  passenger_max_pool_size <%= @passenger[:max_pool_size] %>;
  passenger_min_instances <%= @passenger[:min_instances] %>;
  passenger_pool_idle_time <%= @passenger[:pool_idle_time] %>;
  passenger_max_instances_per_app <%= @passenger[:max_instances_per_app] %>;

  <% unless @passenger[:disable_access_log] %>
  access_log	<%= @log_path %>/access.log;
  <% end %>

  include mime.types;
  default_type application/octet-stream;

  sendfile <%= @passenger[:sendfile] ? 'on' : 'off' %>;
  tcp_nopush <%= @passenger[:tcp_nopush] ? 'on' : 'off' %>;
  keepalive_timeout <%= @passenger[:keepalive_timeout] %>;

  gzip <%= @passenger[:gzip] ? 'on' : 'off' %>;
  <% if @passenger[:gzip] %>
  gzip_http_version <%= @passenger[:gzip_http_version] %>;
  gzip_comp_level <%= @passenger[:gzip_comp_level] %>;
  gzip_proxied <%= @passenger[:gzip_proxied] %>;
  gzip_types <%= @passenger[:gzip_types].join(' ') %>;
  gzip_buffers <%= @passenger[:gzip_buffers] %>;
  gzip_disable "<%= @passenger[:gzip_disable] %>";
  gzip_vary <%= @passenger[:gzip_vary] %>;
  <% end %>

  include sites.d/*.conf;

}

<% @passenger[:pre_start].each do |url| %>
  passenger_pre_start <%= url %>;
<% end %>
